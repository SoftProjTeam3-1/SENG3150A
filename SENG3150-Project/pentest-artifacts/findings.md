# Penetration Test Report

**Target:** http://localhost:5173 (Frontend), Spring Boot Backend API endpoints
**Test start:** 2024-01-15 14:30 UTC
**Test end:** 2024-01-15 16:45 UTC


---

## Executive summary

**7 findings identified:** 2 Critical, 2 High, 2 Medium, 1 Low. 

**Critical Issues:** Insecure cookie configuration and overly permissive CORS settings create significant security risks. 

**Top recommended actions:**
1. Immediately configure secure cookie settings for production
2. Restrict CORS origins to specific domains
3. Implement proper authorization checks on public endpoints
4. Add CSRF protection mechanisms

---

## Scope

- Hosts tested:
  - http://localhost:5173 (React Frontend)
  - Spring Boot Backend API (http://localhost:8080 assumed)
- Ports: 5173, 8080
- Code repos scanned:
  - frontend: ReactVite- Frontend/
  - backend: SprintBoot- Backend/demo/

---

## Methodology

**Tools used:**
- Static Code Analysis (Manual)
- Semantic Code Search
- Configuration Review
- JWT Token Analysis
- CORS Configuration Assessment

**Approach:** Comprehensive code review focusing on authentication mechanisms, API endpoints, security configurations, and potential injection vulnerabilities.

---

## Findings

### [Critical] Insecure Cookie Configuration in Production

**Affected endpoint(s):** `/api/user/login`, `/api/auth/refresh`
**Location / file:** `SprintBoot- Backend/demo/src/main/resources/application.properties` (lines 30-31)
**Severity:** Critical
**CVSS (estimate):** 8.1 (AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:N)

**Description:**
The application configures cookies with `secure=false` and `same-site=Lax`, making refresh tokens vulnerable to interception over HTTP and potential CSRF attacks.

**Evidence:**
- Configuration found:
```
app.cookies.secure=false
app.cookies.same-site=Lax
```
- Code implementation in UserController.java:
```java
ResponseCookie cookie = ResponseCookie.from("refreshToken", refresh)
    .httpOnly(true)
    .secure(cookieSecure)      // false in current config
    .sameSite(sameSite)        // "Lax" allows some cross-site usage
```

**Impact:**
- Refresh tokens can be intercepted over unencrypted HTTP connections
- Potential session hijacking and account takeover
- Cross-site request forgery vulnerabilities

**Remediation / Mitigation:**
- Set `app.cookies.secure=true` for production deployments
- Use `app.cookies.same-site=Strict` for enhanced CSRF protection
- Implement HTTPS-only deployment strategy
- Add secure flag validation in deployment pipeline

**Backlog entry:** (ID: `BK-001`) see `backlog.md` for ticket.

---

### [Critical] Overly Permissive CORS Configuration

**Affected endpoint(s):** All API endpoints
**Location / file:** `SprintBoot- Backend/demo/src/main/java/com/example/config/SecurityConfig.java` (line 68)
**Severity:** Critical
**CVSS (estimate):** 7.5 (AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N)

**Description:**
CORS configuration allows all headers (`"*"`) and exposes all headers (`"*"`), creating potential for cross-origin attacks.

**Evidence:**
- SecurityConfig.java configuration:
```java
cfg.setAllowedHeaders(List.of("*"));   
cfg.setExposedHeaders(List.of("*"));
```

**Impact:**
- Potential for malicious websites to make authenticated requests
- Information disclosure through exposed headers
- Bypass of browser same-origin policy protections

**Remediation / Mitigation:**
- Explicitly list required headers instead of using wildcards
- Remove `setExposedHeaders(List.of("*"))`
- Implement header whitelist: `["Content-Type", "Authorization", "X-Requested-With"]`
- Regular CORS policy review and testing

**Backlog entry:** (ID: `BK-002`) see `backlog.md` for ticket.

---

### [High] Public Endpoints Lack Authorization Checks

**Affected endpoint(s):** `/api/activityType/**`, `/api/sessionActivity/**`
**Location / file:** `SprintBoot- Backend/demo/src/main/java/com/example/config/SecurityConfig.java` (lines 44-47)
**Severity:** High
**CVSS (estimate):** 6.5 (AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:L/A:N)

**Description:**
ActivityType and SessionActivity endpoints are configured as public (`permitAll()`) for "easier local testing" but lack proper authorization in production.

**Evidence:**
- SecurityConfig.java shows:
```java
// make these public for easier local testing
"/api/activityType/**",
"/api/sessionActivity/**"
```

**Impact:**
- Unauthorized access to sensitive activity data
- Potential data manipulation without authentication
- Business logic bypass vulnerabilities

**Remediation / Mitigation:**
- Remove `permitAll()` configuration for production
- Implement proper JWT-based authorization
- Add role-based access control (RBAC)
- Use environment-specific security profiles

**Backlog entry:** (ID: `BK-003`) see `backlog.md` for ticket.

---

### [High] Missing CSRF Protection

**Affected endpoint(s):** All POST/PUT/DELETE endpoints
**Location / file:** `SprintBoot- Backend/demo/src/main/java/com/example/config/SecurityConfig.java` (line 33)
**Severity:** High
**CVSS (estimate):** 6.1 (AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N)

**Description:**
CSRF protection is completely disabled in the security configuration, making all state-changing operations vulnerable to cross-site request forgery.

**Evidence:**
- SecurityConfig.java configuration:
```java
.csrf(csrf -> csrf.disable())
```

**Impact:**
- Attackers can perform unauthorized actions on behalf of authenticated users
- Account takeover through malicious websites
- Data manipulation and unauthorized transactions

**Remediation / Mitigation:**
- Enable CSRF protection with proper token validation
- Implement SameSite cookie attributes
- Add CSRF tokens to all forms
- Use double-submit cookie pattern for API endpoints

**Backlog entry:** (ID: `BK-004`) see `backlog.md` for ticket.

---

### [Medium] Inconsistent Error Handling Exposes System Information

**Affected endpoint(s):** Various controllers
**Location / file:** Multiple controller files
**Severity:** Medium
**CVSS (estimate):** 4.3 (AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N)

**Description:**
Error handling varies across controllers, potentially exposing sensitive system information through stack traces and detailed error messages.

**Evidence:**
- SessionController.java shows generic exception handling:
```java
} catch (Exception e) {
    return new ResponseEntity<>(null, HttpStatus.UNAUTHORIZED);
}
```

**Impact:**
- Information disclosure about system architecture
- Potential enumeration of valid/invalid inputs
- Debugging information exposure to attackers

**Remediation / Mitigation:**
- Implement consistent error handling across all controllers
- Use generic error messages for user-facing responses
- Log detailed errors server-side only
- Implement proper exception mapping

**Backlog entry:** (ID: `BK-005`) see `backlog.md` for ticket.

---

### [Medium] Weak Password Reset Implementation

**Affected endpoint(s):** `/api/user/forgotpassword`, `/api/user/verify-reset-code`, `/api/user/reset-password`
**Location / file:** `SprintBoot- Backend/demo/src/main/java/com/example/controllers/ForgotPasswordController.java`
**Severity:** Medium
**CVSS (estimate):** 5.3 (AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:L/A:N)

**Description:**
Password reset implementation uses simple 4-digit codes and lacks proper expiration or rate limiting.

**Evidence:**
- ForgotPasswordController.java shows:
```java
String code = String.valueOf(new Random().nextInt(9000) + 1000);
```

**Impact:**
- Brute force attacks on reset codes
- Account takeover through code guessing
- No protection against repeated reset requests

**Remediation / Mitigation:**
- Implement longer, cryptographically secure reset tokens
- Add expiration time for reset codes
- Implement rate limiting on reset attempts
- Use secure random number generation

**Backlog entry:** (ID: `BK-006`) see `backlog.md` for ticket.

---

### [Low] Debug Information in Production Code

**Affected endpoint(s):** Various endpoints
**Location / file:** Multiple controller files
**Severity:** Low
**CVSS (estimate):** 2.1 (AV:L/AC:L/PR:L/UI:N/S:U/C:L/I:N/A:N)

**Description:**
System.out.println statements are present in production code, potentially exposing sensitive information in logs.

**Evidence:**
- Multiple occurrences found:
```java
System.out.println("User fetched from DB: " + (u != null ? u.getEmail() : "null"));
System.out.println("Authenticated user: " + (user != null ? user.getEmail() : "null"));
```

**Impact:**
- Information disclosure in application logs
- Performance impact from console output
- Potential exposure of user data

**Remediation / Mitigation:**
- Replace System.out.println with proper logging framework
- Configure appropriate log levels for production
- Sanitize logged information
- Implement log rotation and secure storage

**Backlog entry:** (ID: `BK-007`) see `backlog.md` for ticket.

---

## Additional notes

**Security Strengths Observed:**
- JWT-based authentication properly implemented
- Password hashing using BCrypt
- HttpOnly cookies for refresh tokens
- Input validation in place for login forms

**Areas for Continued Security Focus:**
- Implement comprehensive API security testing
- Regular dependency vulnerability scanning
- Security headers assessment (CSP, HSTS, etc.)
- Rate limiting implementation across all endpoints

**Testing Limitations:**
- Dynamic testing was limited to static code analysis
- No live penetration testing performed against running application
- Database security assessment not conducted

---

## ZAP Findings

## CSP  Header not set
Content Security Policy (CSP) is an added layer of security that helps to detect and mitigate certain types of attacks, including Cross Site Scripting (XSS) and data injection attacks. These attacks are used for everything from data theft to site defacement or distribution of malware. CSP provides a set of standard HTTP headers that allow website owners to declare approved sources of content that browsers should be allowed to load on that page â€” covered types are JavaScript, CSS, HTML frames, fonts, images and embeddable objects such as Java applets, ActiveX, audio and video files.

## Solution:
 Ensure that your web server, application server, load balancer, etc. is configured to set the Content-Security-Policy header.

 ## Missing Anit-Clickjacking Header 
 The response does not protect against 'ClickJacking' attacks. It should include either Content-Security-Policy with 'frame-ancestors' directive or X-Frame-Options.

## Solution 
Modern Web browsers support the Content-Security-Policy and X-Frame-Options HTTP headers. Ensure one of them is set on all web pages returned by your site/app.
If you expect the page to be framed only by pages on your server (e.g. it's part of a FRAMESET) then you'll want to use SAMEORIGIN, otherwise if you never expect the page to be framed, you should use DENY. Alternatively consider implementing Content Security Policy's "frame-ancestors" dire

## Time stamp Disclosure
A timestamp was disclosed by the application/web server. - Unix

## Solution
Manually confirm that the timestamp data is not sensitive, and that the data cannot be aggregated to disclose exploitable patt

## X-Content-Type-Options header missing 
content type other than the declared content type. Current (early 2014) and legacy versions of Firefox will use the declared content type (if one is set), rather than performing MIME-sniffing.

## Solution
Ensure that the application/web server sets the Content-Type header appropriately, and that it sets the X-Content-Type-Options header to 'nosniff' for all web pages.

## Todo Comments 
The following pattern was used: \bTODO\b and was detected in likely comment: "// TODO: rename these fields to something more meaningful.", see evidence field for the suspicious comment/snippet.

## Solution
Remove all comments that return information that may help an attacker and fix any underlying problems they refer to.

